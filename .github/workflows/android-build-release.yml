- name: Patch AndroidManifest.xml
        working-directory: GroceryMobileApp/app/src/main
        run: |
          MF="AndroidManifest.xml"
          if grep -q 'package=' "$MF"; then
            sed -i -E 's/package="[^"]+"/package="codecanyon.grocery"/' "$MF"
          fi

          # Tambah android:exported untuk activity utama
          if grep -q 'SplashActivity' "$MF"; then
            sed -i -E 's#<activity([^>]*SplashActivity[^>]*)>#<activity\1 android:exported="true">#' "$MF"
          fi

          # Tambah android:exported untuk FCM service
          if grep -q 'MyFirebaseMessagingService' "$MF"; then
            sed -i -E 's#<service([^>]*MyFirebaseMessagingService[^>]*)>#<service\1 android:exported="false">#' "$MF"
          fi

      - name: Build release APK
        working-directory: GroceryMobileApp
        run: ./gradlew --no-daemon :app:assembleRelease

      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: android-release
          path: GroceryMobileApp/app/build/outputs/apk/release/*.apk
